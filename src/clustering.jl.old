# File: src/clustering.jl

function cluster_simplices(simplices::Vector{Simplex{N}}) where N
    num_s = length(simplices)
    if num_s == 0 return 0, Simplex{N}[] end
    
    g = SimpleGraph(num_s)
    
    # Baue Graph: Kante zwischen Simplizes, wenn sie eine Facette teilen
    # Dies entspricht der SciPy "Star-Domain" oder "Complex" Logik
    for i in 1:num_s
        for j in i+1:num_s
            # Schneller Check über Indizes
            common = 0
            for idx_i in simplices[i].indices
                for idx_j in simplices[j].indices
                    if idx_i == idx_j
                        common += 1
                        break
                    end
                end
            end
            
            # In N Dimensionen teilen benachbarte Simplizes N Punkte
            if common >= N
                add_edge!(g, i, j)
            end
        end
    end
    
    comps = connected_components(g)
    # Pro Basin ein Repräsentant (Simplex mit dem niedrigsten Minimum-Vertex)
    representative_simplices = [simplices[c[1]] for c in comps]
    
    return length(comps), representative_simplices
end